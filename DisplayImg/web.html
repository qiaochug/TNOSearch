<!-- This, is a comment that does not affect any of the code we write. We can use this to leave notes in the code for our future selves, or for others reading our code. This is also the most basic HTML document you can create. -->
<!DOCTYPE html>
<html>
  <head>
    <title>Triplet Visual Evaluation</title>
  </head>
    <body>
    <p>Instruction:</p>
    <p> 1. Upload a cvs file, each row containing three
    IDs of the three object in a triplet 
    <br>2. For each display, if the triplet is
    shown to be problematic, mark as noise(if not marked, the triplet
    would be marked as good)
    <br> 3. Click through all triplets in the csv file
    by clicking "Display Next" 
    <br> 4. When the webpage alert that you have reached the end of the cvs file, save the result of evluation by clicking "Export Result to CSV", the CSV file would have in every row three IDs and a forth column of 1 or 0, with 1 meaning good and 0 meaning noise. The forth column shows 1 if the triplet has been evaluated in the web app, 0 otherwise. The last column is for keeping track of progress in case user need to exit before finishing all the evaluation.
    <br> 5. You could upload multiple csv files and export result in one csv after finishing evaluation of all of them
    </p >
    <input type="file" id = "fileUpload">
    <button onclick="Upload()">Upload</button>
    <button onclick="Display()">Display Next</button>
    <table id = "dvCSV", style="display: none">

    <a download="testDownload.csv" href="#" onclick="return ExcellentExport.csv(this, 'tableResult');">Export Result to CSV</a>
    <br>
    <br>
    <button onclick = "ToggleEvaluation(), UpdateEvaluation()", id = "toggle">Toggle Evaluation</button>
    <div id = "Mark", style = "color: #1DA0E0">Marked as Good</div>
    <script type="text/javascript">
     var rowNum = -1;
     var eva = 1; //store the current evaluation result, reset to 1
     //for each next display
     var table = document.createElement("table");
     table.id = "tableResult";
     var imgd1 = document.createElement("img");
     var imgs1 = document.createElement("img");
     var imgt1 = document.createElement("img");
     var imgd2 = document.createElement("img");
     var imgs2 = document.createElement("img");
     var imgt2 = document.createElement("img");
     var imgd3 = document.createElement("img");
     var imgs3 = document.createElement("img");
     var imgt3 = document.createElement("img");
     var space1 = document.createElement("br");
     var space2 = document.createElement("br");
    function Upload() {
        var fileUpload = document.getElementById("fileUpload");
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var rows = e.target.result.split("\n");
                    for (var i = 0; i < rows.length; i++) {
                        var row = table.insertRow(-1);
                        var cells = rows[i].split(",");
                        for (var j = 0; j < cells.length; j++) {
                           var cell = row.insertCell(-1);
                           cell.innerHTML = cells[j];
                        }
                        var cell = row.insertCell(-1);
                        cell.innerHTML = eva;
                        cell = row.insertCell(-1);
                        cell.innerHTML = 0; //not yet evaluated
                    }
                    var dvCSV = document.getElementById("dvCSV");
                    dvCSV.innerHTML = "";
                    dvCSV.appendChild(table);
                    }
                    reader.readAsText(fileUpload.files[0]);
                    alert("File successfully uploaded!");
                } else {
                    alert("This browser does not support HTML5.");
                }
            } else {
                alert("Please upload a valid CSV file.");
            }
        }

        function Display(){
            if(rowNum != -1){
            table.rows[rowNum].cells.item(4).innerHTML = 1;
            }
            rowNum = rowNum + 1;
            if (rowNum >= table.rows.length){
                alert("Reached the end of the table");
                rowNum = rowNum -1;
                return;
            }
            var first = table.rows[rowNum].cells.item(0).innerHTML;
            var second = table.rows[rowNum].cells.item(1).innerHTML;
            var third = table.rows[rowNum].cells.item(2).innerHTML;
            eva = 1;
            UpdateEvaluation();
            imgd1.width = 100; imgs1.width = 100; imgt1.width = 100;
            imgd1.height = 100; imgs1.height = 100; imgt1.height = 100;
            imgd2.width = 100; imgs2.width = 100; imgt2.width = 100;
            imgd2.height = 100; imgs2.height = 100; imgt2.height = 100;
            imgd3.width = 100; imgs3.width = 100; imgt3.width = 100;
            imgd3.height = 100; imgs3.height = 100; imgt3.height = 100;
            imgd1.src = "diff" +  first + ".gif";
            imgs1.src = "srch" + first + ".gif";
            imgt1.src = "temp" + first + ".gif";
            imgd2.src = "diff" +  second + ".gif";
            imgs2.src = "srch" + second + ".gif";
            imgt2.src = "temp" + second + ".gif";
            imgd3.src = "diff" +  third + ".gif";
            imgs3.src = "srch" + third + ".gif";
            imgt3.src = "temp" + third + ".gif";
            document.body.appendChild(imgd1);
            document.body.appendChild(imgs1);
            document.body.appendChild(imgt1);
            document.body.appendChild(space1);
            document.body.appendChild(imgd2);
            document.body.appendChild(imgs2);
            document.body.appendChild(imgt2);
            document.body.appendChild(space2);
            document.body.appendChild(imgd3);
            document.body.appendChild(imgs3);
            document.body.appendChild(imgt3);
        }

        function ToggleEvaluation(){
            eva = 1-eva;
        }

        function UpdateEvaluation(){
            var  x = document.getElementById("Mark");
            if (eva == 0){
                x.innerHTML = "Marked as Noise";
                x.style = "color: #82101C";
                eva = 0;
            }else{
                x.innerHTML = "Marked as Good";
                x.style = "color: #1DA0E0";
                eva = 1;
            }
            table.rows[rowNum].cells.item(3).innerHTML = eva;
        }
</script>
    <script src="excellentexport.js"></script>
  </body>
</html>